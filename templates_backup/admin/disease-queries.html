<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Disease Queries - Admin Panel</title>
    <link rel="stylesheet" th:href="@{/css/style.css}" />
</head>

<body>
    <div class="dashboard-layout">
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-brand">
                <div class="brand-icon">ğŸŒ¾</div>
                <div class="brand-text">
                    <h3>Smart Farming</h3><span>Admin Panel</span>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-section-title">Admin Menu</div>
                <a th:href="@{/admin/dashboard}"><span class="nav-icon">ğŸ“Š</span> Dashboard</a>
                <a th:href="@{/admin/users}"><span class="nav-icon">ğŸ‘¥</span> Manage Users</a>
                <a th:href="@{/admin/crops}"><span class="nav-icon">ğŸŒ±</span> Manage Crops</a>
                <a th:href="@{/admin/market-prices}"><span class="nav-icon">ğŸ“ˆ</span> Market Prices</a>
                <a th:href="@{/admin/schemes}"><span class="nav-icon">ğŸ›ï¸</span> Govt. Schemes</a>
                <a th:href="@{/admin/disease-queries}" class="active"><span class="nav-icon">ğŸ”¬</span> Disease
                    Queries</a>
                <a th:href="@{/admin/marketplace}"><span class="nav-icon">ğŸ›’</span> Marketplace</a>
                <div class="nav-section-title">Account</div>
                <a th:href="@{/logout}"><span class="nav-icon">ğŸšª</span> Logout</a>
            </nav>
        </aside>
        <div class="main-content">
            <header class="top-nav">
                <div class="top-nav-left">
                    <div class="hamburger" onclick="toggleSidebar()"><span></span><span></span><span></span></div>
                    <span class="page-title">ğŸ”¬ Disease Queries</span>
                </div>
            </header>
            <div class="page-body">
                <div th:if="${successMessage}" class="alert alert-success">âœ… <span th:text="${successMessage}"></span>
                </div>

                <div class="card">
                    <div class="card-header">
                        <span class="card-title">ğŸ”¬ All Disease Queries</span>
                        <span class="badge badge-warning" th:text="${queries.size()} + ' queries'"></span>
                    </div>
                    <div class="card-body" style="padding:16px;">
                        <div th:if="${queries.empty}" class="empty-state">
                            <div class="empty-state-icon">ğŸ”¬</div>
                            <h3>No disease queries yet</h3>
                            <p>Farmers haven't submitted any disease detection queries</p>
                        </div>

                        <div th:each="q : ${queries}"
                            style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:20px;margin-bottom:16px;">
                            <div
                                style="display:flex;justify-content:space-between;align-items:start;margin-bottom:14px;flex-wrap:wrap;gap:10px;">
                                <div>
                                    <div style="font-size:18px;font-weight:800;color:#22c55e;margin-bottom:2px;"
                                        th:text="${q.cropName}"></div>
                                    <div style="font-size:12px;color:#6b7280;">
                                        ğŸ‘¨â€ğŸŒ¾ <span th:text="${q.farmer.fullName}"></span>
                                        &nbsp;â€¢&nbsp; <span th:text="${q.farmer.phone}"></span>
                                        &nbsp;â€¢&nbsp; <span th:text="${q.createdAt}"></span>
                                    </div>
                                </div>
                                <span class="badge"
                                    th:classappend="${q.status.name() == 'PENDING' ? 'badge-warning' : (q.status.name() == 'DIAGNOSED' ? 'badge-success' : 'badge-info')}"
                                    th:text="${q.status}"></span>
                            </div>

                            <div style="margin-bottom:14px;">
                                <div style="font-size:12px;font-weight:600;color:#6b7280;margin-bottom:4px;">SYMPTOMS
                                    DESCRIBED</div>
                                <div style="font-size:14px;color:#f0fdf4;padding:12px;background:rgba(22,163,74,0.05);border-radius:8px;border:1px solid rgba(22,163,74,0.1);"
                                    th:text="${q.symptoms}"></div>
                            </div>

                            <div th:if="${q.diagnosis}" style="margin-bottom:14px;">
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;">
                                    <div
                                        style="padding:12px;background:rgba(22,163,74,0.08);border-radius:8px;border:1px solid rgba(22,163,74,0.15);">
                                        <div style="font-size:11px;font-weight:700;color:#22c55e;margin-bottom:4px;">ğŸ©º
                                            DIAGNOSIS</div>
                                        <div style="font-size:13px;color:#f0fdf4;" th:text="${q.diagnosis}"></div>
                                    </div>
                                    <div
                                        style="padding:12px;background:rgba(251,191,36,0.08);border-radius:8px;border:1px solid rgba(251,191,36,0.15);">
                                        <div style="font-size:11px;font-weight:700;color:#fbbf24;margin-bottom:4px;">ğŸ’Š
                                            TREATMENT</div>
                                        <div style="font-size:13px;color:#f0fdf4;" th:text="${q.treatment}"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Update Form (always show for admin) -->
                            <form th:action="@{/admin/disease-queries/update/{id}(id=${q.id})}" method="post">
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:12px;">
                                    <div>
                                        <label class="form-label">ğŸ©º Update Diagnosis</label>
                                        <textarea name="diagnosis" class="form-control" rows="3"
                                            placeholder="Enter diagnosis..." th:text="${q.diagnosis}"></textarea>
                                    </div>
                                    <div>
                                        <label class="form-label">ğŸ’Š Update Treatment</label>
                                        <textarea name="treatment" class="form-control" rows="3"
                                            placeholder="Enter treatment plan..." th:text="${q.treatment}"></textarea>
                                    </div>
                                </div>
                                <div style="display:flex;gap:10px;align-items:center;">
                                    <button type="submit" class="btn btn-primary btn-sm">ğŸ’¾ Save Diagnosis</button>
                                    <div style="font-size:12px;color:#6b7280;" th:if="${q.diagnosis}">âœ… Already has
                                        diagnosis â€” update to refine</div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>function toggleSidebar() { document.getElementById('sidebar').classList.toggle('open'); }</script>
</body>

</html>